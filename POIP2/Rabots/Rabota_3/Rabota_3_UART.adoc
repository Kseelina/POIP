---
title: Отчёт по передачи данных по UART
---

:reproducible:

:description: Rabota_3
:keywords: AsciiDoc
:imagesdir: ImgRabota_3
:figure-caption: Рисунок
:table-caption: Таблица


:toc-title: Содержание
:toc:

[text-right]
--
 Выполнила студентка группы КЭ-413
 Прокопьева Ксения
--
[.notes]
UART - это интерфейс по которому происходит обмен информацией.

Интерфейс деляться на 2 вида:

    Синхронные - когда программа отправила по интерфейсу запрос и ждёт пока ей не придёт ответ.

    Асинхронные - когда программа отправила по интерфейсц запрос и не дожидаясь ответа
начала выполнять свои функции, и в какой-то момент времени (в который программа ждать не будет)
может прийти ответное сообщение.

== Таблица прерываний
В нашем микроконтролле имеется таблица прерываний для каждой периферии (file:///R:/POIP/POIP/stm32f411_1.pdf (с.201-204):

.Фрагмент таблицы прерываний
image::ФрагментТаблицыПрерываний.png[]

Согласно данной таблице можно определить положение UART относительно системного таймера:

.Позиция USART2
image::ПозицияUART.png[]

== Алгоритм работы и настройка USART

1. Подключить USART к источнику тактирования – устанавливаем бит USART2EN в
регистре APB1ENR (АЦП тактируется от матрицы шин APB1).
2. Необходимо сконфигурировать порты. Настроить порты, на альтернативную функцию
нужного модуля USART.
3. Настроить формат передачи байт, с помощью регистра CR1 и CR2.
4. Задать скорость передачи с помощью регистра BRR.
5. Разрешить передачу помощью бита TE и если надо прием, с помощью бита RE в модуле
USART с помощью регистра CR1.
6. Включить сам модуль USART битом UE в регистре CR1.
7. Если работаем через прерывание, то разрешить глобальное прерывание для нужного
USART, в регистре ISER[1] модуля NVIC.
8. Если работаем через прерывание, в зависимости от того, что нам нужно, разрешить
прерывание по сигналу модуля UART (например, от сигнала регистр данных передачика
пуст (бит TXEIE в регистре CR1)).

Таким образом, согласно описанным действиям в файле *main.cpp* добавим следующий код:
.Файл main.cpp
[source, c++]
-------
#include "usart2registers.hpp"   // Регистры USART для передачи данных

int main()
{
...
//--------------------------------Передача данных-------------------------------
  RCC::APB1ENR::USART2EN::Enable::Set();      // Подать тактирование на UART
  NVIC::ISER1::Write(1U << 6U);              // UART = 38 позиция от системного таймера (38-32 = 6), разрешить глобальное прерывание
  USART2::CR1::UE::Enable::Set();            // включение модуля
  USART2::CR1::M::Data8bits::Set();         // передача данных по 8 бит

  USART2::CR1::TXEIE::InterruptWhenTXE::Set();   // разрешить прерывание по передаче
  USART2::CR1::TCIE::InterruptWhenTC::Set();     // разрешить прерывание по концу передачи
  USART2::CR1::RXNEIE::InterruptWhenRXNE::Set(); // разрешить прерывание по приёму

  USART2::CR1::TE::Enable::Set();       // разрешить передачу
  USART2::CR1::RE::Enable::Set();       // Разрешить приём

  USART2::CR2::STOP::Value0::Set();    // 1 стоповый бит

  USART2::BRR::DIV_Mantissa::Set(11U);  // какая-то скорость;)

//------------------------------------------------------------------------------
...
}
-------


== Вывод
Я научилась 

